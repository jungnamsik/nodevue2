<!DOCTYPE html>
<html lang="en">
<body>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    var square = 'square' ;
    var joinedRoom = square;
    var socket = io('http://localhost:7000?aaa=123');

    socket.on('connect', function(){
        console.log("connected")
        makeJoin( joinedRoom );
    });

    socket.on('disconnect', function(){
        console.log("disconnected!!");
    });

    function send() {
        const date = new Date();
        let msg = "EVENT PUSH!!!" + date;
        socket.emit('message', {room: joinedRoom, msg: msg}, function(ret) {
            console.log("message.callback>>", ret) ;
        });
    }

    function makeJoin (roomid) {
        socket.emit('join', roomid, ()=>{
            if (roomid != joinedRoom)
                socket.emit('leave', joinedRoom);
            joinedRoom = roomid ;
        }) ;
    }
    send();
    </script>

</body>
</html>